{
	"name": "Dataflow_Misumi_Preparation",
	"properties": {
		"description": "Merging the individual items and product categories and cleaning process",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"name": "Misumi"
				},
				{
					"name": "Items"
				}
			],
			"sinks": [
				{
					"name": "MergedData",
					"description": "merge the products and items table"
				}
			],
			"transformations": [
				{
					"name": "updateDescriptionColumn",
					"description": "Update description column and change the non-word characters"
				},
				{
					"name": "join"
				},
				{
					"name": "checkDuplicates",
					"description": "drop duplicates rows"
				}
			],
			"scriptLines": [
				"source(allowSchemaDrift: true,",
				"     validateSchema: false) ~> Misumi",
				"source(allowSchemaDrift: true,",
				"     validateSchema: false) ~> Items",
				"Items derive(description = regexReplace(description, \"^[a-zA-Z0-9_.-]\", \"\")) ~> updateDescriptionColumn",
				"Misumi, updateDescriptionColumn join({Item } == categoryName,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join",
				"join aggregate(groupBy(categoryCode,",
				"          seriesCode),",
				"     each(match(!in(['categoryCode', 'seriesCode'], name)), $$ = first($$))) ~> checkDuplicates",
				"checkDuplicates sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> MergedData"
			]
		}
	}
}